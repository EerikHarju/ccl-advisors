---
// Header.astro - New implementation from scratch for CCL Advisory Oy

import HeaderLink from './HeaderLink.astro';

const services = [
  { label: 'Transactions', href: '/services/transactions' },
  { label: 'Commercial Contracts', href: '/services/commercial-contracts' },
  { label: 'Corporate', href: '/services/corporate' },
  { label: 'Legal Operations', href: '/services/legal-operations' },
];
---

<header>
  <nav role="navigation" aria-label="Primary navigation" class="nav-container">
    <div class="nav-inner">
      <a href="/" class="site-title" aria-label="CCL Advisory Oy Home">CCL Advisory Oy</a>

      <ul class="nav-list">
        <li><HeaderLink href="/">Home</HeaderLink></li>
        <li><HeaderLink href="/about">About</HeaderLink></li>

        <li class="dropdown" tabindex="0" aria-haspopup="true" aria-expanded="false">
          <button id="services-menu-button" aria-controls="services-menu" aria-expanded="false" aria-haspopup="true" type="button">
            Services
            <span aria-hidden="true" class="dropdown-arrow">â–¾</span>
          </button>
          <ul id="services-menu" class="dropdown-menu" role="menu" aria-labelledby="services-menu-button" hidden>
            {services.map(service => (
              <li role="none">
                <HeaderLink role="menuitem" href={service.href}>{service.label}</HeaderLink>
              </li>
            ))}
          </ul>
        </li>

        <li><HeaderLink href="/references">References</HeaderLink></li>
        <li><HeaderLink href="/contact">Contact</HeaderLink></li>
      </ul>
    </div>
  </nav>
</header>

<style>
  /* Container and centering */
  .nav-container {
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 1rem 2rem;
  }

  .nav-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
  }

  /* Site title */
  .site-title {
    font-family: 'Atkinson', serif;
    font-weight: 700;
    font-size: 1.5rem;
    color: #2337ff;
    text-decoration: none;
    margin-right: 3rem;
    align-self: center;
  }

  /* Nav list layout and reset */
  .nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 2rem;
    align-items: center;
    font-family: 'Atkinson', serif;
    font-weight: 600;
  }

  .nav-list > li {
    position: relative;
  }

  /* HeaderLink styles inside nav */
  .nav-list a {
    color: #2337ff;
    text-decoration: none;
    font-weight: 600;
    padding: 0.25rem 0;
    border-bottom: 3px solid transparent;
    transition: border-color 0.25s ease, color 0.25s ease;
    font-size: 1rem;
  }

  .nav-list a:hover,
  .nav-list a.active {
    border-bottom-color: #2337ff;
    color: #1a1a1a;
  }

  /* Dropdown styles */
  .dropdown > button {
    background: none;
    border: none;
    cursor: pointer;
    font-family: 'Atkinson', serif;
    font-weight: 600;
    font-size: 1rem;
    color: #2337ff;
    padding: 0.25rem 0;
    border-bottom: 3px solid transparent;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .dropdown > button:hover,
  .dropdown > button:focus {
    border-bottom-color: #2337ff;
    color: #1a1a1a;
    outline: none;
  }

  .dropdown-arrow {
    font-size: 0.7rem;
    user-select: none;
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.25rem;
    background: #fff;
    border-radius: 0.3rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    list-style: none;
    padding: 0.5rem 0;
    min-width: 180px;
    z-index: 1000;
  }

  .dropdown-menu[hidden] {
    display: none;
  }

  .dropdown-menu li {
    margin: 0;
  }

  .dropdown-menu a {
    display: block;
    padding: 0.5rem 1.25rem;
    color: #2337ff;
    font-weight: 500;
    border-bottom: none;
    font-size: 0.95rem;
    white-space: nowrap;
  }

  .dropdown-menu a:hover,
  .dropdown-menu a:focus {
    background-color: #f0f4ff;
    color: #1a1a1a;
    outline: none;
  }

  /* Accessibility focus */
  button:focus-visible,
  a:focus-visible {
    outline: 2px solid #2337ff;
    outline-offset: 2px;
  }

  /* Responsive: center nav items on smaller screens */
  @media (max-width: 900px) {
    .nav-inner {
      flex-wrap: wrap;
      justify-content: center;
    }
    .site-title {
      margin-bottom: 1rem;
      margin-right: 0;
    }
  }
</style>

<script>
  // Dropdown toggle
  const btn = document.querySelector('.dropdown > button');
  const menu = document.getElementById('services-menu');

  btn.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!expanded));
    if (!expanded) {
      menu.removeAttribute('hidden');
    } else {
      menu.setAttribute('hidden', '');
    }
  });

  // Close dropdown if clicking outside
  document.addEventListener('click', (e) => {
    if (!btn.contains(e.target) && !menu.contains(e.target)) {
      btn.setAttribute('aria-expanded', 'false');
      menu.setAttribute('hidden', '');
    }
  });

  // Keyboard navigation
  btn.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      btn.setAttribute('aria-expanded', 'true');
      menu.removeAttribute('hidden');
      menu.querySelector('a').focus();
    }
  });

  menu.addEventListener('keydown', (e) => {
    const focusable = Array.from(menu.querySelectorAll('a'));
    let index = focusable.indexOf(document.activeElement);
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      index = (index + 1) % focusable.length;
      focusable[index].focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      index = (index - 1 + focusable.length) % focusable.length;
      focusable[index].focus();
    } else if (e.key === 'Escape') {
      btn.focus();
      btn.setAttribute('aria-expanded', 'false');
      menu.setAttribute('hidden', '');
    }
  });
</script>
