---
// Header.astro
import HeaderLink from './HeaderLink.astro';
import { SITE_TITLE } from '../consts';
---

<header>
  <nav>
    <h2><a href="/" aria-label={SITE_TITLE}>{SITE_TITLE}</a></h2>
    <div class="nav-links">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>

      <div class="dropdown">
        <button aria-haspopup="true" aria-expanded="false" aria-controls="services-menu" id="services-button">
          Services
        </button>
        <ul id="services-menu" role="menu" aria-labelledby="services-button" hidden>
          <li role="none"><HeaderLink role="menuitem" href="/services/transactions">Transactions</HeaderLink></li>
          <li role="none"><HeaderLink role="menuitem" href="/services/commercial-contracts">Commercial Contracts</HeaderLink></li>
          <li role="none"><HeaderLink role="menuitem" href="/services/corporate">Corporate</HeaderLink></li>
          <li role="none"><HeaderLink role="menuitem" href="/services/legal-operations">Legal Operations</HeaderLink></li>
        </ul>
      </div>

      <HeaderLink href="/references">References</HeaderLink>
      <HeaderLink href="/contact">Contact</HeaderLink>
    </div>
  </nav>
</header>

<style>
  header {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    padding: 0 2rem;
  }

  nav {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    position: relative;
  }

  h2 {
    margin: 0;
    font-weight: 700;
    font-size: 1.25rem;
  }

  h2 a {
    color: #1a1a1a;
    text-decoration: none;
    font-weight: 700;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 1.75rem;
  }

  a {
    font-weight: 600;
    color: #2337ff;
    text-decoration: none;
    padding: 0.5rem 0;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s ease;
  }

  a:hover,
  a.active {
    border-bottom-color: #2337ff;
    color: #1a1a1a;
  }

  /* Dropdown styles */
  .dropdown {
    position: relative;
  }

  .dropdown > button {
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 600;
    color: #2337ff;
    padding: 0.5rem 0;
    font-size: 1rem;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s ease;
    display: flex;
    align-items: center;
  }

  .dropdown > button:hover,
  .dropdown > button:focus {
    border-bottom-color: #2337ff;
    color: #1a1a1a;
    outline: none;
  }

  .dropdown ul {
    list-style: none;
    position: absolute;
    top: 100%;
    left: 0;
    margin: 0;
    padding: 0.5rem 0;
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-radius: 4px;
    min-width: 200px;
    z-index: 10;
  }

  .dropdown ul[hidden] {
    display: none;
  }

  .dropdown ul li {
    padding: 0;
  }

  .dropdown ul li a {
    display: block;
    padding: 0.5rem 1.25rem;
    color: #2337ff;
    font-weight: 500;
    border-bottom: none;
  }

  .dropdown ul li a:hover,
  .dropdown ul li a:focus {
    background-color: #f0f4ff;
    color: #1a1a1a;
    outline: none;
  }
</style>

<script>
  // Simple dropdown toggle script for accessibility & keyboard support
  const btn = document.getElementById('services-button');
  const menu = document.getElementById('services-menu');

  btn.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!expanded));
    if (!expanded) {
      menu.removeAttribute('hidden');
    } else {
      menu.setAttribute('hidden', '');
    }
  });

  // Close dropdown if clicked outside
  document.addEventListener('click', (e) => {
    if (!btn.contains(e.target) && !menu.contains(e.target)) {
      btn.setAttribute('aria-expanded', 'false');
      menu.setAttribute('hidden', '');
    }
  });

  // Keyboard navigation
  btn.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      btn.setAttribute('aria-expanded', 'true');
      menu.removeAttribute('hidden');
      menu.querySelector('a').focus();
    }
  });

  menu.addEventListener('keydown', (e) => {
    const focusableItems = Array.from(menu.querySelectorAll('a'));
    let index = focusableItems.indexOf(document.activeElement);
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      index = (index + 1) % focusableItems.length;
      focusableItems[index].focus();
    }
    if (e.key === 'ArrowUp') {
      e.preventDefault();
      index = (index - 1 + focusableItems.length) % focusableItems.length;
      focusableItems[index].focus();
    }
    if (e.key === 'Escape') {
      btn.focus();
      btn.setAttribute('aria-expanded', 'false');
      menu.setAttribute('hidden', '');
    }
  });
</script>
